<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ruleta 1‚Äì500</title>
  <style>
    :root {
      --bg: #0b0f14;
      --card: #121826;
      --text: #e8eef7;
      --muted: #9aa7b5;
      --accent: #33E3D7;
      --accent2: #019993;
      --danger: #ff4d4d;
    }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 50% 0%, #142033, var(--bg));
      color: var(--text);
      min-height: 100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
    }
    .wrap{
      display:grid;
      grid-template-columns: 420px 360px;
      gap: 18px;
      align-items:start;
      max-width: 900px;
      width:100%;
    }
    .card{
      background: rgba(18,24,38,0.85);
      border: 1px solid rgba(51,227,215,0.25);
      box-shadow: 0 12px 30px rgba(0,0,0,0.35);
      border-radius: 18px;
      padding: 16px;
      backdrop-filter: blur(6px);
    }
    .title{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:12px;
      margin-bottom: 10px;
    }
    .title h1{
      font-size: 18px;
      margin: 0;
      letter-spacing: .2px;
    }
    .title span{
      color: var(--muted);
      font-size: 12px;
    }

    /* Wheel */
    .wheelBox{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 12px;
    }
    canvas{
      width: 360px;
      height: 360px;
      border-radius: 50%;
      background: #0a0f18;
      border: 2px solid rgba(51,227,215,0.35);
    }
    .pointer{
      width: 0;
      height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-bottom: 24px solid var(--accent);
      margin-top: -6px;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.5));
    }
    .result{
      width:100%;
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .big{
      background: rgba(1,153,147,0.12);
      border: 1px solid rgba(1,153,147,0.35);
      border-radius: 14px;
      padding: 12px;
      text-align:center;
    }
    .big .label{
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 6px;
    }
    .big .num{
      font-size: 42px;
      font-weight: 800;
      letter-spacing: 1px;
      color: var(--accent);
    }

    /* Controls */
    .controls{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    button{
      border: 0;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 700;
      cursor: pointer;
      transition: transform .05s ease;
    }
    button:active{ transform: scale(.98); }
    .btnPrimary{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #06202a;
    }
    .btnGhost{
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.10);
    }
    .btnDanger{
      background: rgba(255,77,77,0.12);
      color: #ffb3b3;
      border: 1px solid rgba(255,77,77,0.35);
    }

    .toggles{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      margin-top: 8px;
      color: var(--muted);
      font-size: 13px;
    }
    .toggles label{
      display:flex;
      align-items:center;
      gap: 8px;
      user-select:none;
    }
    input[type="checkbox"]{
      width: 18px; height: 18px;
      accent-color: var(--accent);
    }

    /* Right panel */
    .statRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.06);
      margin-bottom: 10px;
      color: var(--muted);
      font-size: 13px;
    }
    .statRow b{ color: var(--text); }

    .log{
      max-height: 330px;
      overflow:auto;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(0,0,0,0.18);
      padding: 10px;
    }
    .logItem{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.06);
      margin-bottom: 8px;
      font-size: 13px;
    }
    .logItem .n{
      font-weight: 800;
      color: var(--accent);
    }
    .hint{
      color: var(--muted);
      font-size: 12px;
      margin-top: 10px;
      line-height: 1.35;
    }

    @media (max-width: 860px){
      .wrap{ grid-template-columns: 1fr; }
      canvas{ width: 320px; height: 320px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="title">
        <h1>üé° Ruleta de rifa (1‚Äì500)</h1>
        <span>Uso r√°pido ‚Ä¢ Transparente ‚Ä¢ Un d√≠a</span>
      </div>

      <div class="wheelBox">
        <div class="pointer"></div>
        <canvas id="wheel" width="720" height="720"></canvas>

        <div class="result">
          <div class="big">
            <div class="label">N√∫mero ganador</div>
            <div class="num" id="winner">‚Äî</div>
          </div>

          <div class="controls">
            <button class="btnPrimary" id="spinBtn">GIRAR</button>
            <button class="btnGhost" id="copyBtn">COPIAR RESULTADO</button>
            <button class="btnDanger" id="resetBtn">REINICIAR TODO</button>
            <button class="btnGhost" id="toggleFullscreen">PANTALLA COMPLETA</button>
          </div>

          <div class="toggles">
            <label><input type="checkbox" id="noRepeat" checked> No repetir n√∫meros</label>
            <label><input type="checkbox" id="showTicks" checked> Mostrar marcas</label>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="title">
        <h1>üìå Control</h1>
        <span>Historial para tu transmisi√≥n</span>
      </div>

      <div class="statRow">
        <span>Disponibles</span>
        <b id="availableCount">500</b>
      </div>
      <div class="statRow">
        <span>Ganadores sacados</span>
        <b id="pickedCount">0</b>
      </div>

      <div class="log" id="log"></div>

      <div class="hint">
        Tips pro para que nadie te venga con cuentos:
        <br>‚Ä¢ Abre esto en PC y comparte pantalla.
        <br>‚Ä¢ Activa ‚ÄúNo repetir‚Äù si solo habr√° 1 ganador (o varios sin repetir).
        <br>‚Ä¢ Guarda el video del live. Eso es tu ‚Äúacta‚Äù.
      </div>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('wheel');
  const ctx = canvas.getContext('2d');

  const winnerEl = document.getElementById('winner');
  const availableCountEl = document.getElementById('availableCount');
  const pickedCountEl = document.getElementById('pickedCount');
  const logEl = document.getElementById('log');

  const spinBtn = document.getElementById('spinBtn');
  const copyBtn = document.getElementById('copyBtn');
  const resetBtn = document.getElementById('resetBtn');
  const noRepeatEl = document.getElementById('noRepeat');
  const showTicksEl = document.getElementById('showTicks');
  const fullscreenBtn = document.getElementById('toggleFullscreen');

  const TOTAL = 500;

  // Estado
  let numbers = Array.from({length: TOTAL}, (_, i) => i + 1);
  let picked = [];
  let angle = 0;          // √°ngulo actual del dibujo
  let spinning = false;

  // Apariencia: no intentamos escribir 500 textos (no caben).
  // Dibujamos ‚Äúsegmentos‚Äù finos + marcas y un aro bonito.
  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const radius = Math.min(cx, cy) - 20;

  function drawWheel() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Fondo circular
    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(angle);

    // Segmentos: 500 (muy finos)
    const seg = (Math.PI * 2) / TOTAL;

    for (let i=0; i<TOTAL; i++){
      const start = i * seg;
      const end = start + seg;

      // Alternar tonos para que se ‚Äúnote‚Äù que hay segmentos
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.arc(0,0,radius, start, end);
      ctx.closePath();
      ctx.fillStyle = (i % 2 === 0) ? "rgba(51,227,215,0.18)" : "rgba(255,255,255,0.08)";
      ctx.fill();
    }

    // Marcas cada 10 y cada 50 (opcional)
    if (showTicksEl.checked){
      for (let i=0; i<TOTAL; i++){
        const a = i * seg;
        const is50 = (i % 50 === 0);
        const is10 = (i % 10 === 0);
        if (!is10 && !is50) continue;

        ctx.save();
        ctx.rotate(a);
        ctx.beginPath();
        ctx.strokeStyle = is50 ? "rgba(51,227,215,0.9)" : "rgba(255,255,255,0.35)";
        ctx.lineWidth = is50 ? 6 : 3;
        ctx.moveTo(radius - (is50 ? 55 : 35), 0);
        ctx.lineTo(radius - 10, 0);
        ctx.stroke();
        ctx.restore();
      }
    }

    // Aro exterior
    ctx.beginPath();
    ctx.arc(0,0,radius,0,Math.PI*2);
    ctx.strokeStyle = "rgba(51,227,215,0.45)";
    ctx.lineWidth = 8;
    ctx.stroke();

    // Centro
    ctx.beginPath();
    ctx.arc(0,0,60,0,Math.PI*2);
    ctx.fillStyle = "rgba(0,0,0,0.35)";
    ctx.fill();
    ctx.lineWidth = 3;
    ctx.strokeStyle = "rgba(255,255,255,0.12)";
    ctx.stroke();

    ctx.restore();

    // Puntero (tri√°ngulo a la derecha)
    // El puntero est√° ‚Äúfijo‚Äù, por eso el ganador depende del √°ngulo final.
    ctx.save();
    ctx.translate(cx, cy);
    ctx.beginPath();
    ctx.moveTo(radius + 8, 0);
    ctx.lineTo(radius + 60, -24);
    ctx.lineTo(radius + 60, 24);
    ctx.closePath();
    ctx.fillStyle = "rgba(51,227,215,0.95)";
    ctx.fill();
    ctx.restore();

    // Texto ‚Äú1‚Äì500‚Äù peque√±o abajo del centro
    ctx.save();
    ctx.translate(cx, cy);
    ctx.fillStyle = "rgba(232,238,247,0.75)";
    ctx.font = "700 22px system-ui";
    ctx.textAlign = "center";
    ctx.fillText("1‚Äì500", 0, 8);
    ctx.restore();
  }

  function updateStats(){
    availableCountEl.textContent = numbers.length;
    pickedCountEl.textContent = picked.length;
  }

  function addLog(num){
    const time = new Date().toLocaleTimeString();
    const div = document.createElement('div');
    div.className = 'logItem';
    div.innerHTML = `<span>Ganador</span><span class="n">#${num}</span><span style="color:var(--muted)">${time}</span>`;
    logEl.prepend(div);
  }

  // Calcular el n√∫mero que queda bajo el puntero (derecha)
  function getNumberFromAngle(){
    // Puntero a la derecha = √°ngulo 0 en sistema local del canvas
    // Ajuste: convertimos la rotaci√≥n actual a un √≠ndice.
    // Si angle aumenta, la rueda rota. Queremos el segmento ‚Äúdebajo del puntero‚Äù.
    const seg = (Math.PI * 2) / TOTAL;

    // Normalizamos angle a [0, 2pi)
    let a = angle % (Math.PI * 2);
    if (a < 0) a += Math.PI * 2;

    // El puntero est√° a 0 rad, pero el dibujo inicia en 0 rad a la derecha.
    // El √≠ndice ganador es el que queda en 0 al rotar la rueda: depende de -angle.
    // Invertimos:
    let idx = Math.floor(((Math.PI*2 - a) % (Math.PI*2)) / seg);

    // idx va 0..TOTAL-1 corresponde a n√∫mero idx+1
    return idx + 1;
  }

  function pickWinnerFromSpin(){
    // N√∫mero que apunta el puntero
    let num = getNumberFromAngle();

    // Si est√° activado "no repetir", y ya sali√≥, buscamos el m√°s cercano siguiente disponible.
    if (noRepeatEl.checked){
      if (!numbers.includes(num)){
        // Buscar hacia arriba circularmente
        let test = num;
        for (let i=0; i<TOTAL; i++){
          test++;
          if (test > TOTAL) test = 1;
          if (numbers.includes(test)){
            num = test;
            break;
          }
        }
      }
      // Remover de disponibles
      numbers = numbers.filter(n => n !== num);
    }

    picked.push(num);
    winnerEl.textContent = num;
    addLog(num);
    updateStats();
  }

  function spin(){
    if (spinning) return;

    if (noRepeatEl.checked && numbers.length === 0){
      alert("Ya no quedan n√∫meros disponibles.");
      return;
    }

    spinning = true;
    spinBtn.disabled = true;

    // Girar: hacemos una animaci√≥n con easing.
    const start = performance.now();
    const duration = 4200 + Math.random() * 1400; // 4.2‚Äì5.6s
    const startAngle = angle;

    // Vueltas grandes + un extra aleatorio
    const turns = 10 + Math.random() * 8; // 10‚Äì18 vueltas
    const extra = Math.random() * Math.PI * 2;
    const targetAngle = startAngle + (Math.PI * 2) * turns + extra;

    function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

    function animate(now){
      const t = Math.min(1, (now - start) / duration);
      const eased = easeOutCubic(t);
      angle = startAngle + (targetAngle - startAngle) * eased;
      drawWheel();

      if (t < 1){
        requestAnimationFrame(animate);
      } else {
        // Ajuste final "snap" m√≠nimo para estabilidad visual
        angle = targetAngle;
        drawWheel();
        pickWinnerFromSpin();

        spinning = false;
        spinBtn.disabled = false;
      }
    }
    requestAnimationFrame(animate);
  }

  function copyResult(){
    const w = winnerEl.textContent.trim();
    if (!w || w === "‚Äî"){
      alert("Todav√≠a no hay ganador.");
      return;
    }
    const text = `GANADOR RIFA: #${w}`;
    navigator.clipboard?.writeText(text).then(() => {
      copyBtn.textContent = "COPIADO ‚úÖ";
      setTimeout(() => copyBtn.textContent = "COPIAR RESULTADO", 1200);
    }).catch(() => {
      prompt("Copia esto:", text);
    });
  }

  function resetAll(){
    if (!confirm("¬øReiniciar todo? Se borrar√° el historial y se reinician los n√∫meros.")) return;
    numbers = Array.from({length: TOTAL}, (_, i) => i + 1);
    picked = [];
    winnerEl.textContent = "‚Äî";
    logEl.innerHTML = "";
    updateStats();
    drawWheel();
  }

  async function toggleFullscreen(){
    try{
      if (!document.fullscreenElement){
        await document.documentElement.requestFullscreen();
      } else {
        await document.exitFullscreen();
      }
    } catch(e){
      alert("Tu navegador no permiti√≥ pantalla completa.");
    }
  }

  // Eventos
  spinBtn.addEventListener('click', spin);
  copyBtn.addEventListener('click', copyResult);
  resetBtn.addEventListener('click', resetAll);
  showTicksEl.addEventListener('change', drawWheel);
  fullscreenBtn.addEventListener('click', toggleFullscreen);

  // Inicial
  updateStats();
  drawWheel();
})();
</script>
</body>
</html>
